[TOC]

### 高性能MySQL

> 本笔记来源高性能MySQL 第三版

> 2021-5-19

#### 定义

##### 术语

- [x] 客户端、服务端、存储引擎
- [x] 数据库
- [x] 数据表
- [x] 数据行(记录)
- [x] 数据列(字段)

##### 数据

###### 数值类型

|       类型       |                   大小                   |      范围（有符号）      | 范围（无符号） |  用途  |
| :--------------: | :--------------------------------------: | :----------------------: | :------------: | :----: |
|   **TINYINT**    |                  1 byte                  |        (-128,127)        |    (0,255)     | 小整数 |
|     SMALLINT     |                 2 bytes                  |      (-32768,32767)      |   (0,65 535)   | 大整数 |
|    MEDIUMINT     |                 3 bytes                  |    (-8388608,8388607)    |  (0,16777215)  | 大整数 |
| **INT或INTEGER** |                 4 bytes                  | (-2147483648,2147483647) | (0,4294967295) | 大整数 |
|      BIGINT      |                 8 bytes                  |                          |                |  极大  |
|      FLOAT       |                 4 bytes                  |                          |                | 单精度 |
|      DOUBLE      |                 8 bytes                  |                          |                | 双精度 |
|     DECIMAL      | 对DECIMAL(M,D) ，如果M>D，为M+2否则为D+2 |      依赖于M和D的值      | 依赖于M和D的值 | 小数值 |

###### 字符串

|     类型     |         大小          |              用途               |
| :----------: | :-------------------: | :-----------------------------: |
|   **CHAR**   |      0-255 bytes      |           定长字符串            |
| **VARCHAR**  |     0-65535 bytes     |           变长字符串            |
|   TINYBLOB   |      0-255 bytes      | 不超过 255 个字符的二进制字符串 |
|   TINYTEXT   |      0-255 bytes      |          短文本字符串           |
|     BLOB     |    0-65 535 bytes     |     二进制形式的长文本数据      |
|   **TEXT**   |    0-65 535 bytes     |           长文本数据            |
|  MEDIUMBLOB  |  0-16 777 215 bytes   |  二进制形式的中等长度文本数据   |
|  MEDIUMTEXT  |  0-16 777 215 bytes   |        中等长度文本数据         |
|   LONGBLOB   | 0-4 294 967 295 bytes |    二进制形式的极大文本数据     |
| **LONGTEXT** | 0-4 294 967 295 bytes |          极大文本数据           |

###### 日期

|   类型    | 大小 |                  范围                   |        格式         |         用途         |
| :-------: | :--: | :-------------------------------------: | :-----------------: | :------------------: |
|   DATE    |  3   |          1000-01-01/9999-12-31          |     YYYY-MM-DD      |        日期值        |
|   TIME    |  3   |        '-838:59:59'/'838:59:59'         |      HH:MM:SS       |   时间值或持续时间   |
|   YEAR    |  1   |                1901/2155                |        YYYY         |        年份值        |
| DATETIME  |  8   | 1000-01-01 00:00:00/9999-12-31 23:59:59 | YYYY-MM-DD HH:MM:SS |     混合日期时间     |
| TIMESTAMP |  4   |                                         |   YYYYMMDD HHMMSS   | 混合日期时间值时间戳 |

###### 枚举

~~~mysql
enum('0', '1')  -- 比如性别或者其他的基本固定的选择
~~~

#### 约束

>   数据完整性：存储在数据库中的所有数据值均正确的状态. 
>
>   如果数据库中存储有不正确的数据值, 则该数据库称为已丧失数据完整性. 数据完整性包括: 
>
>   1.  域完整性
>   2.  实体完整性
>   3.  参考完整性（外键）

数据库通过约束来保证数据完整性. 它通过对表的行或列的数据做出限制, 来确保表的数据的准确性, 完整性、唯一性, 可靠性、联动性. 

###### 主键

> 推荐表都新建唯一主键、并且自动增长

###### 唯一

###### 非空

###### 默认

###### 外键

> 详细见SQL

#### SQL

> 1. 完整SQL语句采用分号结尾
> 2. 大小写不敏感，推荐关键词大些，其他小写

##### DDL

###### 定义

> Data Definition Language: 操作数据库、表

~~~mysql
CREATE
ALTER
DROP
TRUNCATE
COMMENT
GRANT
REVOKE
~~~

###### Examples

1. 基础操作

~~~mysql
-- 连接
mysql -u root -p
-- 数据库操作
mysql> show databases;
mysql> create database dbname charset utf8;
mysql> show create database \G;
mysql> alter database dbname charset utf8mb4;
mysql> use dbname;
mysql> show status;
mysql> show GRANTS;
mysql> drop database dbname;

mysql> create table t_name(
    id int primary key auto_increment, 
    name char(10) not null default 'Mike',
    card unique,
    index idx_card (card)
    class_id int not null,
	constraint fk_name foreign key(class_id) references t_class(id)
)engine=innodb default charset=utf8mb4;
	
mysql> show tables; 			     				-- 查看所有数据表
mysql> show create table t_name;					-- 显示创建表的信息
mysql> show create table t_name \G; 				-- 显示创建表的信息
mysql> desc t_name; 				 				-- 查看字段信息/表结构,比较常用的

mysql> source path/filename.sql						-- 导入之前必须要有表
# 备份
mysqldump -uroot -p dbname > filename.sql 			-- 导出数据库 表结构+数据
mysqldump -uroot -p -d dbname > filename.sql		-- 表结构
mysqldump -uroot -p dbname t_name > filename.sql	-- 导出数据表
~~~

2. 修改表结构、表约束

~~~mysql
-- 字段
mysql> alter table t_name add field_name type;	    -- 增加字段
mysql> alter table t_name add primary key(id);		-- 增加属性
mysql> alter table t_name drop field_name;			-- 删除字段
mysql> alter table t_name modify field_name type;	-- 修改字段
mysql> alter table t_name change old_field_name new_field_name type;
-- 索引
mysql> create index idx_name_card on t_name (name, card);
mysql> drop index idx_name_card on t_name;
mysql> alter table t_name add index idx_name(name);

mysql> create unique index idx_card on t_name (card);
mysql> show index from t_name \G;
~~~

##### DML

###### 定义

> Data Manipulation Language：操作数据行

~~~mysql
SELECT
INSERT
UPDATE
DELETE
EXPLAIN # SQL执行计划
LOCK
~~~

###### Examples

~~~mysql
SELECT 
	col1,
	col2
FROM　　　　　  

LEFT JOIN 

WHERE          

GROUP BY      

HAVING　　　  

ORDER BY　　  

LIMIT 
~~~

##### DCL

###### 定义

> Data Control Language

~~~mysql
BEGIN
START transaction
COMMIT
SAVEPOINT
ROLLBACK
SET TRANSACTION
~~~

###### Examples

~~~mysql
mysql> BEGIN;
mysql> ...
mysql> COMMIT;
~~~

#### 权限

1.  查看当前用户权限

~~~mysql
mysql> show grants
~~~

2. 增加用户

~~~mysql
CREATE USER 'test'@'localhost'  IDENTIFIED BY '1234';
CREATE USER 'test'@'%'  IDENTIFIED BY '1234'; 
~~~

3. 权限

~~~mysql
-- 常用权限： create、alter、drop、insert、update、delete、select.   
-- 全部权限： all privileges
mysql> grant select on testdb.* to 'test'@'localhost' with grant option;
mysql> grant update,create,drop on *.* to 'test'@"%" with grant option;
mysql> grant all privileges ON *.* TO 'test'@'localhost' with grant option;
mysql> flush privileges;
~~~

4. 收回权限

~~~mysql
mysql> REVOKE ALL PRIVILEGES , GRANT OPTION FROM 'test'@'localhost'
mysql> flush privileges;
~~~
