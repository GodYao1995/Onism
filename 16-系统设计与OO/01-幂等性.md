[TOC]

### 幂等性

> 同一个操作，执行多次的结果是一致的

#### 重试场景

大多数系统都不是单一的架构，往往需要依赖其他的组件或者子系统。如应用层面REST服务，数据库层面，消息队列层面、子系统RPC服务，一旦调用某个服务"失败"，要么在主调用者重试，要么系统自带重试机制，结果就是可能对同一个操作造成不同的结果。

#### 幂等场景

针对查询以及删除的操作可以认为是幂等的，但是如更新、新增的操作则不是幂等的。

#### 解决办法

##### 唯一索引

> 通过对某个字段加唯一索引，那么在多次新增时，就会直接报错

##### Token

保证幂等性，即是，保证如果当前的操作如果被处理过，那么后续带有唯一标示的操作，即认为是"同一操作"，不处理。核心的观点在于，服务层判断该操作是否执行过。采用Token的模式，可以较好的适应大多数的情景。

在应用层执行操作之前，"静默"申请Token，执行操作携带Token，服务检测是否携带Token，并且该Token是否存在(存储Redis中)，存在即是该操作未被执行，那么删除Token并且生成新Token，执行操作。

以此衍生出各个不同的幂等性的解决场景，如通过流水号。

