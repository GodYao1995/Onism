[TOC]

## 编程设计及通用理论

### 理论2: 分布式ACID、CAP、BASE理论

#### 事务和ACID

##### 事务

事务一个不可分割的操作序列

##### ACID：统一提交，失败回滚

单服务器

1.  原子性，事务是最小的执行单位，不允许分割，确保动作全部执行或者全部不执行
2.  一致性，事务开始和结束后，数据库的约束是一致的，数据总量是不变的
3.  隔离性，多个事务之间是独立的，互不影响的
4.  持久性，事务完成后，对数据的修改是永久的

#### 分布式CAP理论

1.  C一致性，一旦数据更新完成并且返回客户端后，分布式系统中的所有节点数据完全一致
2.  A可用性，服务一直可用，而且是正常响应时间
    *   高可用
    *   容错可用
    *   故障恢复
3.  P分区容错性，部分节点故障，其他的节点任然能提供服务。是分布式系统中具备的基本能力

##### 一致性保证

1.  master-slave模型为例
2.  请求master写操作，对节点全部锁定后不能写不能读，待数据同步后再解锁，返回数据
3.  如果写入失败，那么返回错误，不要返回旧数据

##### 可用性

1.  master-slave模型为例
2.  请求master写后，立即返回，采用异步的方式同步数据

##### 分区容错性

1.  异步的方式来同步数据
2.  数据同步在多个节点，其中一个节点故障，其他的节点可以继续提供服务

##### 不能同时满足3选2

1.  牺牲一致性，满足可用性【不要求强一致，最终一致即可】
2.  牺牲可用性，满足一致性【强制同步后，在返回数据，保证一致性】
3.  分区容错是必须的，那么一致性和可用性必然二选一
4.  AC【无分区容错，追求可用和一致性】
5.  CP【放弃可用性，追求强一致】——跨行转账
6.  AP【放弃一致性，可以最终一致性，NoSQL】——退款

#### BASE理论

1.  基本可用
2.  软状态
3.  最终一致性

##### 基本可用

1.  对时间响应上的妥协
2.  对功能损失的妥协【降级】

##### 软状态

1.  系统中数据处于中间状态，有些节点数据同步可以对外提供服务
2.  中间状态可以对外提供服务，不影响整体的可用性

##### 最终一致性

1.  一定时间期限后，所有的节点数据达到最终一致性

##### BASE与ACID

1.  ACID针对传统数据库模型，追求强一致性
2.  BASE针对大型分布式系统，牺牲强一致性追求高可用性