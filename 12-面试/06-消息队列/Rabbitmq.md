### Rabbitmq

#### 什么场景下使用消息队列?

》考察为什么系统中需要用到消息队列?

通常在需要解耦、异步、削峰的情况下, 需要使用到消息队列. 

第一种需要解耦的情况, 例如A系统需要向B、C、D三个下游系统发送数据, 第一需要对接三个系统的接口, 第二要考虑向下游系统发送数据失败怎么办, 是否需要重发等. 这样A系统就强耦合其他的系统. 这种情况下, A系统可将消息发送到消息队列, 下游系统订阅消息并且消费, 下游方需要就订阅, 不需要就取消, A系统就与下游的系统解耦, 降低的系统之间调用的复杂性. 

第二种需要异步的情况, 例如系统的某个接口, 需要写库、需要发送短信通知、需要发送数据到下游系统. 此接口的时间由多个阶段累计起来造成响应的时间变长, 除了本地写库, 其他的阶段都可以采用消息队列的形式, 将任务提交到消息队列, 由指定的系统来消费完成任务.

第三种需要削峰的情况, 例如系统在某段时间, 突发大量的请求进入, 这样大的请求可能会使得数据库崩溃. 可采用将大量的请求发送到消息队列, 系统按照处理能力去消息队列里面拉取, 这样就解决了突发流量问题.

#### 消息队列有什么优势和劣势?

优势: 就是如上所述, 解耦、异步、削峰; 劣势: 第一种情况, 引入消息队列, 使得系统整体的可用性降低. 消息队列不可用导致很多的服务不可用. 所以必须保证消息队列的高可用. 第二种情况, 使得系统的复杂度提高了, 引入消息队列之后, 如何保证消息不丢失、不重复消费、顺序消费是几个常见的问题. 第三种情况, 业务一致性问题, 上有系统处理完成返回成功, 实际上任务发送消息队列, 消费失败, 造成最后的不一致, 这也是需要注意的地方. 

#### 主流的消息队列有哪些, 如何选型?

主流的消息队列有Kafka、RabbitMQ、ActiveMQ、RocktMQ. 吞吐量方面ActiveMQ=RabbitMQ<RocktMQ=Kafka. 可用性方面ActiveMQ=RabbitMQ采用主从架构, RocktMQ=Kafka采用分布式架构.  时效性方面, RabbitMQ在us级别, 其他在ms级别.  社区活跃度来看RabbitMQ与RocketMQ较好. 通常来说如果业务吞吐量不大, 采用RabbitMQ合适. 如果需要做日志采集等, 采用Kafka较为合适. 

#### Rabbitmq有几种模式, 你常用那种?

普通的生产-消费模式(queue模式), worker模式, 发布-订阅模式, Topic模式, Routing模式. 最常用的是worker模式和发布订阅的模式. worker模式就是多个消费者消费同一个queue, 发布订阅模式就是每个消费者订阅独立的queue, 交换机会发送消息到queue. 

#### Rabbitmq内部实现机制?

#### Rabbitmq部署模式(高可用)?

#### Rabbitmq如何保证消息不丢失(可靠性)?

#### 如何保证消息不重复消费(幂等性)?

#### 如何保证消息顺序消费?

#### 消息堆积, 如果快速消费消息?

