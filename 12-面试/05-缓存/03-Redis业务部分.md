[TOC]

### Redis业务部分

#### Redis分布式锁RedLock有哪些问题?

#### Redis在海量Key中如何找出某些固定开头的Key?

使用 keys 命令, 支持pattter模式.  但是由于Redis单线程处理机制, 数据量太大的话会导致线程阻塞, 影响服务的提供, 所以不是推荐使用keys.  推荐使用 scan 命令, 可以无阻塞的提取指定模式的key列表, 但是有一定几率重复key, 可以手动去重. 

#### Redis如何实现异步消息队列？

通过Redis的List结构, 以及rpush、lpop[lpush, rpop]命令可以是实现异步队列. 需要注意的是: 当key没有数据的时候,lpop无法获取到,lpop空轮询造成客户端CPU压力增大和QPS升高. 可以采用brpop来阻塞获取, 给定一个超时的时间. 

#### Redis性能问题和解决方案？

1.  master节点不要做持久化的工作, 如果数据比较重要Slave开启AOF每秒同步或者每修改同步
2.  最好在同一个机房(网络)内
3.  主从复制采用链表的形式 master——>slave——>slave
4.  避免在压力很大的主库上增加从库

#### Redis与MySQL数据一致性问题？

采用先更新数据库, 然后订阅Binlog变更, 投递到消息队列, 拿到数据去删除对应缓存的数据. 

#### Redis的缓存雪崩、穿透、击穿了解么？分别怎么解决？

缓存雪崩: 某种情况下大面积Key同时失效, 造成Redis无数据, 此时大量的请求进来造成压力全部打到数据库, 要么造成业务延迟, 严重数据库直接宕机.  解决方案: 设置Key的时候随机给上他们的过期时间, 保证不在同一时间大面积失效, 设置热点数据永不过期，需要更新的时候更新就好了. 

缓存穿透: 不断请求数据缓存和数据库中都没有的数据, 导致大量请求直接穿透到数据库, 造成数据库压力过大. 比如请求id为负的记录或者id不存在于数据库的记录或者分页的参数不在数据库范围.  解决方案: 在接口层做严格的参数校验、用户权限校验; 做接口请求的频率限制避免恶意请求; 返回信息提示用户稍后重试, 或者设置Key的默认值, 位置错误; 布隆过滤器快速判断出你这个Key是否在数据库中存在. 

缓存击穿: 指一个热点Key一直被大量请求, 一旦Key失效, 大量请求落到数据库上, 造成数据库压力增大. 解决方案: 设置热点数据不过期并且加上互斥锁. 

#### Redis的zset如何依据两个字段排序？

热度+时间作为排序字段, 这种特点的场景, 解决方法是组装一个浮点数, 整数部分是热度的值, 小数部分是时间

#### Redis的Big key如何解决?

1.  例如：string长度大于10K，list长度大于10240认为是big bigkeys
2.  以hash类型举例来说，对于field过多的场景，可以根据field进行hash取模，生成一个新的key

~~~
hash_key:{filed1:value, filed2:value, filed3:value ...}，可以hash取模后形成如下key:value形式
hash_key:mod1:{filed1:value}
hash_key:mod2:{filed2:value}
hash_key:mod3:{filed3:value}
~~~

3.  string类型的big key, 如文章正文, 建议不要存入redis, 用文档型数据库MongoDB代替或者直接缓存到CDN上

#### Redis的Key如何设置?

避免bigkey、加上模块或者业务前缀、设置过期时间、见明知意 