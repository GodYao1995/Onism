[TOC]

# 计算机组成

## 性能

### 什么是性能？

学习和研究计算机组成原理其实就是理解计算机是怎么运作以及为什么要这么运作。其中为什么就是让性能提升的方法。

对于计算机性能有两个指标衡量

1.  响应时间【执行程序的时间】
2.  吞吐量、带宽【一定时间内处理任务量】

我们可以给出如下定义性能的形式

~~~go
性能 = 1 / 响应时间
~~~

如何提高性能？

1.  减少响应时间
2.  提高吞吐量

### CPU时钟

记录程序运行结束时间减去开始时间，也叫做Wall Clock Time。

虽然时间是生活中常见的计时单位，但是对于CPU来说，由于CPU的运行机制以及其他的影响因素导致时间不准

1.  CPU轮转执行不同的程序
2.  程序执行可能会读取硬盘读取网络数据

~~~go
real = user + sys // 也就是真正的时间是用户态时间 + 操作系统内核时间 
~~~

所以通常我们需要把上面的时间抛去，可以得到程序CPU的执行时间。但是CPU可能满载运行也可能降频运行，并且还受到主板内存以及其他的硬件的影响。所以必须对"时间"概念进行拆解，得到更加精确的程序CPU执行时间：

~~~go
程序CPU执行时间 = CPU时钟周期数 * 时钟周期时间
~~~

那什么是时钟周期时间呢？

购买CPU或者计算机的时候，CPU的型号会标注如 Inter Core-i5-xxxxHQ 2.8GHz. 2.8GHz代表CPU的主频，主频越高代表CPU就越快，但是散热的压力就会越大。2.8GHz代表CPU的"钟表"所能识别的最小时间间隔。CPU内部有一个叫晶体振荡器，每一次"滴答"，就是时钟周期时间.

~~~g
1 / 2.8GHz 
~~~

所以通过缩短时钟周期时间，也就是提高主频可以提升性能。这通常由硬件工程师解决。作为软件工程师我们可以关注CPU时钟周期数，通过减小她也可以提升性能。在对其进行拆解

~~~go
程序CPU执行时间 = 指令数 * 每条指令CPU时钟周期数 * 时钟周期时间
~~~

所以解决性能问题就是优化以上三者

1.  时钟周期时间【硬件解决】
2.  每条指令CPU时钟周期数【CPU流水线技术】
3.  指令数【编译器解决】



## 功耗

### CPU的极限

~~~
程序CPU执行时间 = 指令数 * 每条指令CPU时钟周期数 * 时钟周期时间
~~~

有以上的公式知道，硬件工程师想要提升性能就需要在主频上面下功夫

CPU也叫做超大规模集成电路，由晶体管组成。CPU在计算、其实就是让晶体管里面的开关不断地区“打开”和“关闭”，来组合完成各种运算和功能。所以粗略提升性能的方式如下：

1.  多些晶体管，也就是增加密度
2.  让晶体管“打开”和“关闭”的更快一点，提升主频

而这两者都会增加功耗，带来耗电和散热的问题

*   CPU的面积大，晶体管之间的距离会变大，电信号传输的时间就会变长，运算速度自然就慢了

*   提升了CPU主频，但是动作快过热，对CPU来说就会崩溃出错

### 功率

~~~
功耗 ~= 1/2 ×负载电容×电压的平方×开关频率×晶体管数量
~~~

提高性能

1.  增加晶体管【同等面积下，晶体管必须足够小】【制程的提升使得功耗和散热问题带来了更小的芯片】
2.  降低电压【低压CPU】【CPU通过晶体管电信号模拟开关，所以功率也和电压有关】

但是增加晶体管导致功耗增加太多，CPU的散热跟不上，这个时候就需要降低电压。

### 优化

Intel意识到通过提升主频比较“难”去实现性能提升，所以通过多核CPU来提高吞吐量，而不是响应时间。但是并不是所有的问题都可以通过并行的方式解决

1.  可以拆分
2.  确保能汇总
3.  汇总阶段无法并行

所以具体的程序优化时间可以通过阿姆尔定律描述

~~~go
优化后的执行时间 = 受优化影响的执行时间 / 加速倍数 + 不受影响的执行时间
~~~

### 延伸

还可以通过以下的方式提高性能

1.  GPU、TPU
2.  CPU流水线
3.  预测提高性能【分支和冒险】