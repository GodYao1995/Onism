[TOC]

### SQL优化

先定位、然后分析SQL语句，索引、特殊语句、数据量问题、是否需要拆分表

#### 定位慢SQL？

1.  explain命令来查看语句的执行计划 索引情况，外键等
2.  慢查询日志
    *   是否load了不需要的列
    *   是否命中索引
    *   大表数据切分

#### 大表优化

1.  优化SQL语句，索引
2.  缓存
3.  主从复制，读写分离
4.  垂直拆分
5.  水平拆分

#### 超大分页？

1.  给定大于的条件
2.  靠缓存来预测这种分页数据
3.  减少这种需求

#### SQL语句优化？

1.  count(*) 直接返回数目
2.  查询不需要的数据使用limit
3.  指定需要返回的字段，而不是select *
4.  大查询可分为小查询名，然后自己组织数据
5.  确保sql语句命中索引
6.  关联查询代替子查询
7.  where或者order by的字段建立索引，避免全表扫描
8.  in not in 也可能进行全表扫描
9.  总之要避免全表扫描

#### 主键采用自增id

1.  减少页分裂
2.  自增id是聚簇索引

#### 采用NOT NULL

NULL会占用更多的字节

#### 分库分表面临的问题？

1.  事务支持，分布式事务
2.  跨库join
3.  跨节点的count、order by等
4.  数据迁移
5.  ID问题

#### 主从？

将主数据库中的DDL和DML操作通过二进制日志（BINLOG）传输到从数据库上，然后将这些日志重新执行（重做）；从而使得从数据库的数据与主数据库保持一致

1.  读写分离
2.  从库备份
3.  降低压力
4.  容灾

流程

**主**：binlog线程——记录下所有改变了数据库数据的语句，放进master上的binlog中；

**从**：io线程——在使用start slave 之后，负责从master上拉取 binlog 内容，放进自己的relay log中；

**从**：sql执行线程——执行relay log中的语句

#### 备份

1.  mysqldump
2.  xtranbackup  100G以上的库