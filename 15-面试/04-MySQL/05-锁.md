[TOC]

### 锁

当数据库有并发事务的时候，可能导致产生的数据不一致，这就需要锁机制来保障访问的次序

#### 隔离级别和锁的关系？

1.  读未提交，不需要加共享锁
2.  读提交，读操作加共享锁，语句执行完成释放锁
3.  可重复读，读操作加共享锁，事务执行完成以后才释放共享锁
4.  可串行化，事务执行完成才释放锁

#### 分类

1.  行级锁 InnoDB，开销大，加锁慢，锁粒度小，发生锁冲突概率低，并发度高
2.  表锁 MyISAM，开销小，锁粒度大，发生锁冲突概率高，并发度低
3.  页级锁

InnoDB实现了三种锁，行锁的实现是基于索引的

从类别上看，分为共享锁，和排他锁

#### 死锁

多个事务在同一资源上相互占用，并且请求锁定对方资源

1.  如果并发存取多个表，尽量控制访问顺序
2.  同一个事务，尽量一次锁定所需要的资源
3.  业务处理不好可以使用分布式锁或者乐观锁

#### 乐观锁、悲观锁

1.  悲观锁，假定会发生并发冲突，屏蔽一切可能导致数据不完整的操作，采用数据库锁机制
2.  乐观锁，假定不会发生并发冲突，只是在提交的时候检查是否违背数据完整性。在修改的时候把事务锁起来，通过version版本机制实现。适用于写少的情况。