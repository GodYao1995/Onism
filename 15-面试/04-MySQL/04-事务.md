[TOC]

### 事务

#### 数据库事务

1.  一组原子性的SQL,一个不可分割的数据库操作序列
3.  事务中命令全部执行成功, 要么全都不执行失败

#### ACID

> 

1.  原子性: 事务是最小的执行单位, 不允许分割, 确保动作全部执行或者全部不执行
2.  一致性: 事务执行的结果是数据库从一种一致性状态转变到另一种一致性状态
3.  隔离性: 一个事务所做的修改在最终提交以前，对其他事务是不可见的 (与隔离级别有关)
4.  持久性：一个事务被提交后, 对数据库中的数据改变是持久的

#### 事务状态

1. 活动
2. 部分提交(操作完成，但是并未刷新到磁盘)
3. 失败
4. 终止
5. 提交(操作完成，刷新到磁盘)

#### 并发事务问题

1.  脏读
    * A事务更新, B事务读取, 但是A由于某些原因回滚了, 导致B事务读取的数据不正确
    * 一个事务读取到了另一个事务未提交的数据
2.  不可重复读：
    * A事务查询，B事务更新数据，导致事务A中读取同一个记录的最新值
    * 一个事务读取到了另一个事物多次提交的最新数据
3.  幻读
    * 一个事务的两次查询记录不一致, 两次查询之间其他事务插入了数据
    * 一个事务中多次同条件查询, 读取到了之前没有查询到的数据

#### 隔离级别

> 低级别的隔离，可以换得更高的并发性能，但是也会带来并发事务问题

1.  读未提交 READ UNCOMMITTED, 可能发生脏读、不可重复读、幻读
2.  读提交 READ COMMITTED, 可能发生不可重复读、幻读
3.  可重复读 REPEATABLE READ, 多次读取是一致的, 可能发生幻读
4.  可串行化 SERIALIZABLE, 最高隔离级别符合ACID特性,对读取的每一行加锁(所有事务依次执行)

**MySQL默认使用可重复读, 事务隔离机制的实现基于锁机制和并发调度。其中并发调度使用的是MVVC（多版本并发控制）, 通过保存修改的旧版本信息来支持并发一致性读和回滚等特性**

#### MVCC