### 索引

#### 问题零：SQL需求？

1. 根据某个值精确查找
2. 区间范围查找
3. 顺序、逆序

#### 问题一：数据库索引？

1. 数据结构用来提高查询效率
2. 索引是一种特殊的文件(InnoDB数据表上的索引是表空间的一个组成部分)，包含着对数据表里所有记录的引用指针
3. 索引的创建和维护需要时间和空间资源，而且对表进行增删改动，索引需要重建
4. MySQL InnoDB引擎采用B系列 B+树作为索引实现

#### 问题二：索引的基本原理？

1. 把创建了索引的列的内容进行排序
2. 对排序结果生成倒排表
3. 在倒排表内容上拼上数据地址链
4. 在查询的时候，先拿到倒排表内容，再取出数据地址链，从而拿到具体数据

#### 问题三：为什么使用B+树？

常见的存储查询数据结构

##### Hash

1. 基于Hash表实现【Hash算法有直接定址法、平方取中法、折叠法、除数取余法、随机数法】
2. 精确查找
3. Hash冲突
4. 只能用于对等比较，不能进行范围查询

##### 链表

1. 不支持按照某个值或者区间查找
2. 频繁的插入删除不友好

##### 平衡二叉树

1. 若左子树不空，则左子树上所有节点的值均小于它的根节点的值

   若右子树不空，则右子树上所有节点的值均大于或等于它的根节点的值

   每个非叶子节点的左右子树的高度之差的绝对值（平衡因子）最多为1

2. 不支持范围查找、查找代价和树高有关

##### B树

1. 数据分布在节点，不需要全表扫描，加快访问速度
2. 范围查找需要遍历所有节点

##### B+树

1. 改进平衡二叉树，将所有的叶子结点采用双向链表链接，方便区间查找
2. 记录【或者记录的指针】存储在叶子节点，其他的节点是存储索引
3. 满足基本的三个需求【定值查找、区间查找，顺序和逆序】
4. 空间利用率更高，减少IO次数、磁盘读写效率更高

问题

B+树数据多，树高就会造成IO的访问次数多

1. 采用m叉树，可以减少IO次数
2. m不是越大越好，B+ 树的结构配合计算机磁盘存储页结构默认值为 16 KB，也就是说对于 B+ 树的节点，最好设置成页的大小（16 KB），这样一个 B+ 树上的节点就只会有一次 IO 读

![640-1](file:///Users/admin/Documents/otherSpace/Onism/15-%E9%9D%A2%E8%AF%95/04-MySQL/images/640-1.png?lastModify=1647929903)

#### 问题四：索引分类？

1. 主键索引，数据列不允许重复，不允许为NULL，只能有一个主键索引

2. 普通索引，没有唯一性限制，✅允许为空

3. 唯一索引，数据列不允许重复❎，可以为NULL，可创建多个

4. 联合索引

5. 聚簇索引，不是单独的索引类型，而是一种数据存储方式

   叶节点存放一整行记录的索引被称为聚簇索引，其他的就称为非聚簇索引

6. 非聚簇索引

#### 问题五：索引使用场景？

1. where子句的列
2. order by
3. join

#### 问题五：索引事项？

##### 索引覆盖？

如果要查询的字段都建立过索引，那么就直接在索引表中查询而不是去原始数据查询

##### 命中索引？

1. like在匹配通配符开头的时候，无法索引
2. where中的or、函数、表达式无法命中索引
3. SQL语句中使用函数无法命中索引
4. = 号左边运算也不能命中索引
5. 联合索引【多个字段同时建立一个索引】，索引的必须全部排序使用 name、age、score，要不然不会命中

##### 最左匹配原则？

1. where子句中使用最频繁的一列放在最左边
2. mysql会一直向右匹配直到遇到范围查询(>、<、between、like)就停止匹配，所以有些索引可能使用不到

##### 创建索引

1. 不要过度使用索引
2. mysql会一直向右匹配直到遇到范围查询(>、<、between、like)就停止匹配，所以有些索引可能使用不到、
3. 频繁作为查询条件的字段才建立索引
4. 更新频繁的字段不适合建立索引
5. 定义有外键的数据列一定要建立索引
6. text、bit类型的列不要建立索引

##### 删除大量数据？

1. 先删除索引
2. 再删除数据

##### 回表查询？

1. 聚簇索引：将数据存储与索引放到了一块，找到索引也就找到了数据
2. 非聚簇索引：将数据存储于索引分开结构，索引结构的叶子节点指向了数据的对应行

在InnoDB中，只有主键索引是聚簇索引，如果没有主键，则挑选一个唯一键建立聚簇索引。如果没有唯一键，则隐式的生成一个键来建立聚簇索引。当查询使用聚簇索引时，在对应的叶子节点，可以获取到整行数据，因此不用再次进行回表查询。所以非聚簇索引查询都需要二次查询，也就是回表查询。

非聚簇索引也不一定要回表查询，如果查询的字段都建立了索引，并且全部命中。那么就不需要回表