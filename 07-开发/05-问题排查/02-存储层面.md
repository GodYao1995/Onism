[TOC]

### 数据库层面

#### 线上如何删除数据库大量"问题"数据？

采用程序分批删除的模式, 避免给数据库造成瞬间的压力

#### 数据库连接池大小设置？

一旦线程数超过CPU核心数, 再增加线程系统只会更慢, 而不是更快。 连接数不是越大越好。

数据库的性能瓶颈

- [ ] CPU
- [ ] 内存
- [ ] 磁盘
- [ ] 网络

数据存储在磁盘上, 磁盘需要寻址和旋回, 在这段IO等待时间, 线程是阻塞等待磁盘,  此时操作系统可以将那个空闲的CPU核心用于服务其他线程序。所以由于线程总是在IO上阻塞, 可以让线程/连接数比CPU核心多一些。

新型的SSD不需要寻址和旋回, 阻塞的时间会少, 所以线程数接近CPU会发挥更高的性能。

计算公式并不是绝对的, 可以针对实际的数据库配置、访问量来测试出适合的连接数

~~~
连接数 = ((核心数 * 2) + 有效磁盘数)
~~~

最后, 连接池的大小设置还与系统特性相关, 例如混合了长事务和短事务的系统, 设置连接池调优是困难的。一般情况下, 创建两个连接池, 一个服务长事务、一个服务短事物. 