[TOC]

### count

> 聚合函数用来统计记录的行数

~~~mysql
SELECT COUNT(*) FROM T WHERE ...
~~~

#### 实现

##### MyISam

> 存储表的总行数，但是加了WHERE, 也需要进行统计

##### InnoDB

> 存储引擎取出数据，然后交由Server层累加计数统计

InnoDB才用的是MVCC并发版本控制, 一致性非锁定读(快照读)得到的数据行并不是准确的，因为有些记录并不是当前事务可见的，导致多个事务同一查询时刻得到的数据行数是不同的

#### count(pk)

> 遍历整个表, 取出主键id; Server层拿到id,判断不为空,即累加

#### count(1)

> 遍历整个表, 不取值; Server层放置一个1,一定不为空,即累加

#### count(col)

> 判断col不为null ,累加

#### count(*)

> MySQL做了特殊的优化不取值，肯定不为null, 累加

InnoDB是主键索引表, 主键索引树的叶子结点是数据，而普通索引树的叶子结点数据是主键，所以遍历哪个索引树得到的结果是一致的，优化器会选这最小的那颗树。

通常情况下，推荐使用count(*)

#### 计数

1. 缓存系统计数(多系统会有丢失更新的可能)
2. MySQL数据表计数(通过事务方式,逻辑上准确可行)