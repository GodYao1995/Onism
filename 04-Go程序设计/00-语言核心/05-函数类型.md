[TOC]

### 函数

1. 函数是一种类型
2. 可以作为变量的值
3. 可以作为参数和返回值
4. 支持多值返回
6. 支持可变参数

#### 类型

1. 函数是一种引用类型, 未初始化的函数是nil
2. 函数的类型[去掉函数名、参数名、{}函数体]

 ~~~go
func(int int)
func(int int) int
 ~~~

#### 签名

1. 函数类型又叫做函数的签名
2. 若两个函数的形式参列表和返回值列表一致, 形参名可以不同, 称两个函数的类型相同

#### 定义

声明func、函数名、参数列表、返回值列表、函数体、return

~~~go
func Foo(a int, b int) int {
    num = a + b
    return num
}

// 参数同类型声明, 返回值声明
func Foo(a, b int) (num int) {
    num = a + b
    return
}
// 一般来说如果有错误处理都返回最后一个参数
func Bar(a, b int) (num int, err error) {
    num = a + b
    // 通常不需要显式返回 num, err
    return
}
~~~

**注意**

1. 不支持默认参数(可采用Functional Options)
2. 不支持函数重载
3. 严格意义上来说, **不支持命名函数的嵌套**
4. 函数的调用直接通过()操作符, 或者go关键字调用
5. 返回值列表声明后不需要在函数中再次声明返回值

**不定参数**

1. 必须作为最后一个参数
2. 在函数体中相当于切片

~~~go
func Sum(items ...int) (sum int) {
    for _, item := range items {
        sum += item
    }
    return
}
~~~

#### 调用

~~~go
Foo(1, 2)
Sum(1, 2, 3) // slices := []int{1, 2, 3}  Sum(slices...) 
~~~

**注意: 传递[]T的切片参数, 需要在后面... 解开**

#### 参数

1. 函数的参数传递都是值传递
2. 数字、字符串、布尔值、数组、结构体是值传递
3. slice、map、channel由于是引用类型所以传递的是引用的拷贝[值传递]

#### 返回值

1.  关键字return
2.  函数一旦遇到return就停止
3.  如果没有返回值, 可以不用显式return

~~~go
// 普通模式
func add(a, b int) int {
    return a + b
}

// 多个返回值模式
func eval(a, b int, op string) (int, error) {}

// 尽量使用命名返回值：会使代码更清晰、更简短, 同时更加容易读懂
func twoF(a, b int) (sum int, sub int) {
    sum = a + b
    sub = a - b
   	// 对于指定了返回的变量名, return 后面的值 可以不写, 这种方式比较好
    return  
}

// _ 标识符丢弃返回值
_, sub := twoF(20, 10) 
~~~

#### 作用域

1.  局部变量
    *   函数内部定义的变量
    *   for/if语句中定义的变量属于局部变量
    *   大括号中定义的变量

2.  全局作用域
    *   函数外部的变量[不能和其他文件中的变量重名]
    *   可以在函数内部修改全局变量[会影响其他使用全局变量的地方]

#### 匿名

1.  匿名函数配合 `go` 关键字来作为 goroutine 使用
2.  匿名函数同样被称之为闭包: 它们被允许调用定义在其它环境下的变量
    *   一个闭包继承了函数所声明时的作用域.  
    *   这种状态(作用域内变量)都被共享到闭包的环境中, 因此这些变量可以在闭包中被操作, 直到被销毁

~~~go
// 直接定义匿名函数执行
func (a ,b int) {
    return a + b
}(10, 20)

// 变量接收
var f func(int, int) int
f = func (a, b int) int{
    return a + b
}
f(1, 2)
~~~

#### 内置

|  函数   |         意义         |     注意     |
| :-----: | :------------------: | :----------: |
|   len   |     获取集合长度     |      无      |
|   cap   |     获取切片容量     |      无      |
|  copy   | 拷贝切片到另一个切片 |  见切片类型  |
| append  |       扩容切片       |  见切片类型  |
|   new   |      创建值类型      | 见类型初始化 |
|  make   |     创建引用类型     | 见类型初始化 |
|  panic  |       终止程序       |      无      |
| recover |   恢复panic的程序    | defer中使用  |
|  close  |       关闭通道       |  见通道类型  |