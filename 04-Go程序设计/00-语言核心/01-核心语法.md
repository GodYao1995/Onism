[TOC]

### 核心语法

> 编程, 向计算机发送指令, 计算机接收指令并且执行, 最后输出结果
>
> 源代码、编译、链接、可执行文件

Go语言提供了一系列**语言要素**来完成指令的编写与逻辑组织

1. 包package
2. 数据类型
3. 操作符
4. 声明/赋值变量(数据载体)
5. 函数(功能载体)
6. 类型(实体载体)
7. 条件分支
8. 循环
9. Token(规范), 换行、逗号、大括号、中括号、小括号、单引号、双引号、反引号、分号、冒号
9. 特殊符号, _ 短划线 

为了标示每一种语言要素, 通过如下**25个关键字**,后续依次介绍用法

~~~go
package 
type var const func-return
import
if else
for range continue break
switch-case fallthrough default
goto
defer 
go
chan interface map struct
select-case
~~~

> 通过各种逻辑操作数据, 即是：程序 = 算法(逻辑) + 数据(基础数据+复杂数据结构)

#### 包

Go语言通过包(package)来组织源代码

1. main包是一个特殊的包, 作为入口的包
2. 规定**入口函数必须是main**

~~~go
package main

func main() {
    
}
~~~

**注意**:  **入口函数main无参数、无返回值**（如何运行程序, 参考运行编译）

如何编写自己的包？

通常情况下, 包与目录同名, 并且推荐**包的名称"小巧易读"**(更多的规范可以见**最佳实践**.) 

导入包问题？

导入包实际就是拿到整个包的名称空间, 可以根据需要使得名称对外开放权限, 遵循以下开放权限规则

1. 首字母大写的名称对外开放, 外部可以通过包名访问
2. 首字母小写的名称不对外开放, 外部"无法访问"

~~~go
import "project/internal/logic"
~~~

包的导入还有如下模式:

1. 重命名模式
2. 导入所有的可见名称模式
3. 初始化包(不使用任何名称)模式

~~~go
import lg "project/internal/logic"
import . "project/internal/logic"
import _ "project/internal/init"
~~~

需要注意的是

1. 初始化包的形式会隐式自动调用包内的init函数(通常做初始化操作,无法主动调用)
1. 依赖通常手动SetUp或者DI
2. init函数无参数、无返回值
3. 一个包可以存在多个init函数, 执行顺序是从上到下
3. 初始化总是以单线程执行, 并且按照包的依赖关系顺序执行

~~~go
func init() {
    // init
}
~~~

#### 基础类型

Go提供了基础的内置数据类型

1. 数值类型(整数类型、浮点数类型、复数类型), 支持无符号与有符号数值类型
2. uintptr是一个足够大的数值类型, 用来保存指针
3. 字符串类型
4. 布尔类型【布尔值只有两种true、false】

~~~go
int uint int8 uint8 int16 uint16 int32 uint32 int64 uint64
uintptr
float32 float64
complex64 complex128
string
bool
~~~

特别的, Go还内置了两种类型, byte是uint8 的内置别名, rune是int32的别名, **别名实际上类型是一样的**

~~~go
type byte = uint8
type rune = int32
~~~

**注意：每一种类型都有其表示的范围, 注意参与运算后溢出的可能**

#### 操作符

> Go语言支持：算术运算符、位运算、逻辑运算

**算术运算符**

| 运算符 |           名称            |           二元运算、运算法则           |
| :----: | :-----------------------: | :------------------------------------: |
|   +    |           加法            |     类型必须相同并且为基本数值类型     |
|   -    |           减法            |     类型必须相同并且为基本数值类型     |
|   *    |           乘法            |     类型必须相同并且为基本数值类型     |
|   /    | 除法(整除), 商向0靠拢截断 |     类型必须相同并且为基本数值类型     |
|   %    |           余数            | **类型必须相同并且为基本整数数值类型** |
|  op=   |                           |          支持语句简写如 += -=          |

| 运算符 |  名称  |         **一元运算、运算法则**         |      |
| :----: | :----: | :------------------------------------: | ---- |
|   ++   |  自增  | 类型必须是整数数值类型、**仅支持语句** |      |
|   --   |  自减  | 类型必须是整数数值类型、**仅支持语句** |      |
|   +    | 取正数 |         类型必须是整数数值类型         |      |

**注意：自增、自减(仅支持语句, 也就是说不支持前置运算以及参与其他的运算)**

**特殊的, 字符串支持 + 拼接操作** 

**位运算**

| 运算符 |   名称   |                      二元运算、运算法则                      |
| :----: | :------: | :----------------------------------------------------------: |
|   &    |  按位与  |        两个操作数的类型必须相同并且为基本整数数值类型        |
|   \|   |  按位或  |        两个操作数的类型必须相同并且为基本整数数值类型        |
|   ^    | 按位异或 |        两个操作数的类型必须相同并且为基本整数数值类型        |
|   &^   | 按位清位 | 两个操作数的类型必须相同并且为基本整数数值类型 m &^ n == m & (^n) |
|   <<   |  左移位  | **左操作数必须为一个整数, 右操作数也必须为一个非负整数, 类型可以不同** |
|   >>   |  右移位  | **左操作数必须为一个整数, 右操作数也必须为一个非负整数, 类型可以不同** |

**注意：在右移运算中, 左边空出来的位（即高位）全部用左操作数的最高位（即正负号位）填充**

**布尔运算**

| 运算符 |  名称  |        法则        | 短路操作  |
| :----: | :----: | :----------------: | --------- |
|   &&   | 逻辑与 | 操作数必须为布尔值 | false &&  |
|  \|\|  | 逻辑或 | 操作数必须为布尔值 | true \|\| |
|   !    | 逻辑非 | 操作数必须是布尔值 |           |

操作符优先级

**注意：同一行的优先级相同, 1 ~  5 的优先级逐渐降低**

| 1    | *    | /    | %    | <<   | >>   | &    | &^   |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 2    | +    | -    | \|   | ^    |      |      |      |
| 3    | ==   | !=   | <    | <=   | >    | >=   |      |
| 4    | &&   |      |      |      |      |      |      |
| 5    | \|\| |      |      |      |      |      |      |

#### 声明

> 1. Go 采用 var 来声明**变量**
> 2. const声明常量, 常量不允许修改地址(不可寻址)

~~~go
var num int						
const name string = "GodYao"	
const PI = 3.14
~~~

注意 Go采用**后置类型**, 常量声明的同时需要初始化确定, 并且常量是可以直接类型推断的

~~~go
// 声明并且赋值
var name = "GodYao"			   
~~~

特殊的, iota声明枚举类型, 具体可以**Go语言细节**

~~~go
const (
    python = iota  // 默认iota是0开始, 递增
    JavaScript
    golang
)
~~~

#### 初始化

var模式先声明, 然后在需要的时候进行初始化

~~~go
var num int
num = 10
~~~

在声明的同时初始化, 注意此时的类型可以省略, 并且也是**推荐省略**, **Go语言会进行类型推断**

~~~go
var num = 10
~~~

短变量声明与初始化

~~~go
num := 10
~~~

#### 流程控制

if分支

~~~go
if condition1 {
    // code1
} else {
    // code2
}
if condition1 {
    // code1
} else if condition2 {
    // code2
}
~~~

特别的, **if语句支持简单变量的声明**, 函数调用返回变量模式

~~~go
if v, ok := Foo(); ok {
    // code
}
~~~

switch分支选择

~~~go
// 普通模式
switch expr {
    case:
    	// code
    case:
    	// code
	    fallthrough // 跳到下一个case执行
    case:
    	// code
    default:
    	// code
}

// expr 支持简单语句, 以及表达式 模式
switch n := Foo(); n % 10 {
    case 0:
    case 1, 2, 3:
    case 4, 5, 6:
    default:
}

// case也支持表达式
switch {
    case n == 0:
    case n == 1:
    case n == 2:
    default:
}

// 具体的应用在类型选择(接口断言)
switch t := i.(type) {
    case int:
    case int8, uint8:   // 支持多个
    case int16:
    default:
}
~~~

**注意：switch无法expr-case无法使用浮点数, 并且不需要显式break**

for循环

~~~go
for i := 0; i < limit; i++ {
    // 普通增量模式
}
for index, value := range collections {
    // 遍历集合模式
}
for v := range ch {
    // 读取通道数据
}

// 某些特别的循环模式
var i = 0
for ; i < 10 {
    // 内部增量i
    i++
}
// or
for i < 20 {
    i++
}
// 死循环模式, 通常配合select channle
for {
    
}
~~~

goto

goto语句强制改变运行流程, 非特殊情况建议不使用

~~~go
for {
    // code
    goto Flag
}
Flag:
~~~

#### 函数

1. 支持多返回值, 并且通常情况下最后一个返回值为error类型(**参考最佳实践**)
2. **函数可以作为参数、返回值**
3. 支持不定参数

~~~go
// 多返回值
func Foo(a, b int) (num int, err error) {
    num = a + b
    return num, nil
}
// 不定参数、命名返回值
func sum(items ...int) (sum int) {
    for _, item := range items {
        sum += item
    }
    return
}
~~~

特别的, 在接收返回值时, 可以自定义丢弃某些不需要的变量, 通过使用**空白标识符**

丢弃该变量后续无法使用

~~~go
num, _ := Foo()
~~~

#### defer

延迟函数调用, 更多见语言细节defer

~~~go
func Foo(i int) int {
    defer func() {
        // 延迟到函数return之前
    }()
    return i + 1
}
~~~

#### panic&recover

恐慌与恢复

~~~go
defer func() {
   	// 捕获panic
    if err := recover(); err != nil {
        fmt.Println(err)
    }
}()
panic("panic")
~~~

#### 协程

~~~go
go func() {
    // go 启动一个任务
}
~~~

#### 指针

不支持指针运算 , & 取地址、*解引用, 目标用来轻量级传递数据以及修改数据

#### 零值

类型都有零值, 在未初始化时确定一个值(意思就是声明一个变量, 并未赋值)

1. **数字类型零值, 为0**
2. **布尔类型零值, 为false**
3. **字符串类型零值, 为"" (空字符串)**

#### 字面量

字面量就是类型直观表达出来, 人类能识别的类型值, 字面量都有默认的类型

~~~go
100 							// 十进制
"ab"							// 字符串
0x01							// 十六进制
0b00000011						// 二进制
0o72							// 八进制
1.23							// 浮点数
5.20e2							// 科学计数 9e-2 .1e2
'a'								// rune 类型
1 + 2i							// 复数
1_2 + 3_4   					// 下划线连接数字 12 + 34
\t								// 转义字符 \a \n \r \f
`abc\n`    						// 不转义
~~~

#### 编码

Go默认UTF-8编码

在UTF-8编码中, 一个Unicode码点（rune）可能由1到4个字节组成.  

**每个英文字母的UTF-8编码只需要一个字节；每个中文字符的UTF-8编码需要三个字节**.

#### 扩展

- [x] 表达式: 表示一个值
- [x] 语句：表示一个操作